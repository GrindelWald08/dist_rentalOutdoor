import{c as z,r as v,j as e,t as D,s as I}from"./index-Dp5V46W7.js";import{L as q,f as Y}from"./Layout-Cj4HZ6Vy.js";import{B as w}from"./useAdmin-BxB2P_tw.js";import{I as F}from"./input-Ccy3rJvP.js";import{L as T}from"./label-DcpSdAy0.js";import{P as K,b as L,c as U,C as J,a as _}from"./popover-CBVDSgDv.js";import{f as d}from"./api-9T2QbLlA.js";import{E as V,a as Q,C as X}from"./jspdf.plugin.autotable-CEDGWPTD.js";import{p as f}from"./parseISO-C80PuECi.js";import{t as A,d as Z,f as p,i as N}from"./id-8SRIAgvI.js";import{S as ee}from"./search-B5-fTTbY.js";import{C as $}from"./circle-check-big-rYKVzhDP.js";import"./dropdown-menu-Cc7uZZE_.js";import"./Combination-D7J0VMFL.js";import"./index-CU77mCJl.js";import"./index-BdQq_4o_.js";import"./plus-CAgRuiIJ.js";import"./trash-2-B4YhzpcP.js";import"./chevron-left-Df98c0fY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=z("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=z("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function ae(s,t){const n=A(s),h=A(t),a=W(n,h),x=Math.abs(Z(n,h));n.setDate(n.getDate()-a*x);const l=+(W(n,h)===-a),b=a*(x-l);return b===0?0:b}function W(s,t){const n=s.getFullYear()-t.getFullYear()||s.getMonth()-t.getMonth()||s.getDate()-t.getDate()||s.getHours()-t.getHours()||s.getMinutes()-t.getMinutes()||s.getSeconds()-t.getSeconds()||s.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}const se=s=>{const t=new V,n=t.internal.pageSize.getWidth(),h=[56,161,105],a=[51,51,51],x=[128,128,128];let l=20;if(t.setFillColor(...h),t.rect(0,0,n,45,"F"),t.setTextColor(255,255,255),t.setFontSize(24),t.setFont("helvetica","bold"),t.text("INVOICE",14,l+5),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("RentalGear - Sewa Alat Outdoor",14,l+15),t.text("Jl. Adventure No. 123, Jakarta",14,l+21),t.text("WhatsApp: 081234567890",14,l+27),t.setFontSize(10),t.text(`No: INV-${s.id.slice(0,8).toUpperCase()}`,n-14,l+5,{align:"right"}),t.text(`Tanggal: ${p(new Date,"dd MMMM yyyy",{locale:N})}`,n-14,l+12,{align:"right"}),l=55,t.setTextColor(...a),t.setFillColor(245,245,245),t.roundedRect(14,l,n-28,35,3,3,"F"),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("Ditagihkan Kepada:",20,l+8),t.setFont("helvetica","normal"),t.text(s.customerName,20,l+16),s.customerPhone&&t.text(`Tel: ${s.customerPhone}`,20,l+22),s.customerEmail&&t.text(`Email: ${s.customerEmail}`,20,l+28),t.setFont("helvetica","bold"),t.text("Periode Sewa:",n/2+10,l+8),t.setFont("helvetica","normal"),s.rentalStartDate&&s.rentalEndDate){const c=f(s.rentalStartDate),u=f(s.rentalEndDate),C=ae(u,c)+1;t.text(`${p(c,"dd MMM yyyy",{locale:N})} - ${p(u,"dd MMM yyyy",{locale:N})}`,n/2+10,l+16),t.text(`(${C} hari)`,n/2+10,l+22)}else t.text("-",n/2+10,l+16);if(s.deliveryMethod){t.setFont("helvetica","bold"),t.text("Pengiriman:",n/2+10,l+28),t.setFont("helvetica","normal");const c=s.deliveryMethod==="delivery"?"Antar ke Alamat":"Ambil di Toko";t.text(c,n/2+45,l+28)}l=100;const b=s.items.map(c=>{const u=c.pricePerDay*c.quantity*c.days;return[c.productName,c.quantity.toString(),`${c.days} hari`,d(c.pricePerDay),d(u)]});Q(t,{head:[["Item","Qty","Durasi","Harga/Hari","Subtotal"]],body:b,startY:l,styles:{fontSize:9,cellPadding:4,textColor:a},headStyles:{fillColor:h,textColor:[255,255,255],fontStyle:"bold"},columnStyles:{0:{cellWidth:70},1:{halign:"center",cellWidth:20},2:{halign:"center",cellWidth:25},3:{halign:"right",cellWidth:35},4:{halign:"right",cellWidth:35}},alternateRowStyles:{fillColor:[250,250,250]}});const S=t.lastAutoTable.finalY+10,j=n-80;t.setFontSize(9),t.setTextColor(...x);const k=s.items.reduce((c,u)=>c+u.pricePerDay*u.quantity*u.days,0);let o=S;t.text("Subtotal:",j,o),t.setTextColor(...a),t.text(d(s.subtotal||k),n-14,o,{align:"right"}),o+=7,s.deposit&&s.deposit>0&&(t.setTextColor(...x),t.text("Deposit:",j,o),t.setTextColor(...a),t.text(d(s.deposit),n-14,o,{align:"right"}),o+=7),s.deliveryFee&&s.deliveryFee>0&&(t.setTextColor(...x),t.text("Ongkos Kirim:",j,o),t.setTextColor(...a),t.text(d(s.deliveryFee),n-14,o,{align:"right"}),o+=7),t.setDrawColor(...h),t.setLineWidth(.5),t.line(j-5,o,n-14,o),o+=7,t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(...h),t.text("TOTAL:",j,o),t.text(d(s.total),n-14,o,{align:"right"});const m=t.internal.pageSize.getHeight()-30;t.setDrawColor(200,200,200),t.setLineWidth(.3),t.line(14,m-10,n-14,m-10),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(...x),t.text("Terima kasih telah mempercayakan kebutuhan outdoor Anda kepada kami!",n/2,m,{align:"center"}),t.text("Harap simpan invoice ini sebagai bukti transaksi.",n/2,m+5,{align:"center"}),t.text(`Order ID: ${s.id}`,n/2,m+12,{align:"center"}),s.status==="pending"&&(t.setFontSize(40),t.setTextColor(200,200,200),t.text("MENUNGGU KONFIRMASI",n/2,150,{align:"center",angle:45}));const M=`invoice-${s.id.slice(0,8)}-${p(new Date,"yyyyMMdd")}.pdf`;t.save(M)},ne=s=>{se(s)},we=()=>{const[s,t]=v.useState(""),[n,h]=v.useState(""),[a,x]=v.useState(null),[l,b]=v.useState(),[S,j]=v.useState(!1),[k,o]=v.useState(!1),[m,M]=v.useState(null),c=async i=>{if(i.preventDefault(),!s.trim()||!n.trim()){D({title:"Data tidak lengkap",description:"Masukkan Order ID dan nomor telepon",variant:"destructive"});return}j(!0),x(null),M(null);try{const{data:r,error:y}=await I.functions.invoke("lookup-order",{body:{orderId:s.trim(),phone:n.trim()}});if(y)throw y;if(r.error){D({title:"Pesanan tidak ditemukan",description:r.error,variant:"destructive"});return}x(r.order),r.order.rentalEndDate&&b(_(f(r.order.rentalEndDate),1))}catch(r){console.error("Error searching order:",r),D({title:"Terjadi kesalahan",description:"Gagal mencari pesanan. Silakan coba lagi.",variant:"destructive"})}finally{j(!1)}},u=()=>{if(!a||!a.rentalEndDate||!l)return null;const i=f(a.rentalEndDate),r=l.getTime()-i.getTime(),y=Math.ceil(r/(1e3*60*60*24));if(y<=0)return null;const P=a.items.reduce((H,E)=>H+E.pricePerDay*E.quantity,0),G=P*y;return{extensionDays:y,extensionCost:G,dailyRate:P}},C=async()=>{if(!a||!l)return;const i=u();if(!i||i.extensionDays<=0){D({title:"Tanggal tidak valid",description:"Pilih tanggal setelah tanggal selesai sewa saat ini",variant:"destructive"});return}o(!0);try{const{data:r,error:y}=await I.functions.invoke("extend-rental",{body:{orderId:a.id,phone:n.trim(),newEndDate:p(l,"yyyy-MM-dd")}});if(y)throw y;if(r.error){D({title:"Gagal memperpanjang",description:r.error,variant:"destructive"});return}M({extensionDays:r.extensionDays,extensionCost:r.extensionCost,newTotal:r.newTotal}),D({title:"Perpanjangan berhasil!",description:`Sewa diperpanjang ${r.extensionDays} hari`}),x({...a,rentalEndDate:r.newEndDate,total:r.newTotal})}catch(r){console.error("Error extending rental:",r),D({title:"Terjadi kesalahan",description:"Gagal memperpanjang sewa. Silakan coba lagi.",variant:"destructive"})}finally{o(!1)}},B=()=>{if(!a||!m)return;const i=encodeURIComponent(`*PERPANJANGAN SEWA - RentalGear*

Order ID: ${a.id.slice(0,8)}
Nama: ${a.customerName}

Perpanjangan: ${m.extensionDays} hari
Biaya Tambahan: ${d(m.extensionCost)}
Tanggal Selesai Baru: ${a.rentalEndDate?p(f(a.rentalEndDate),"dd MMMM yyyy",{locale:N}):"-"}

Mohon konfirmasi pembayaran perpanjangan. Terima kasih!`);window.open(`https://wa.me/6281234567890?text=${i}`,"_blank")},g=u(),R=(a==null?void 0:a.status)==="active"&&!(a!=null&&a.actualReturnDate)&&(a==null?void 0:a.rentalEndDate);return e.jsxs(q,{children:[e.jsx("section",{className:"pt-28 pb-12 bg-secondary text-secondary-foreground",children:e.jsxs("div",{className:"container text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold mb-4",children:"Perpanjang Sewa"}),e.jsx("p",{className:"text-secondary-foreground/70 max-w-2xl mx-auto",children:"Perpanjang masa sewa Anda secara online tanpa perlu datang ke toko."})]})}),e.jsx("section",{className:"py-12 bg-background",children:e.jsxs("div",{className:"container max-w-2xl",children:[e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6 sm:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-card-foreground mb-6",children:"Cari Pesanan Anda"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"orderId",children:"Order ID"}),e.jsx(F,{id:"orderId",placeholder:"Masukkan Order ID (contoh: abc12345)",value:s,onChange:i=>t(i.target.value),className:"mt-1.5"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Order ID terdapat di pesan WhatsApp konfirmasi pesanan Anda"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"phone",children:"Nomor WhatsApp"}),e.jsx(F,{id:"phone",type:"tel",placeholder:"081234567890",value:n,onChange:i=>h(i.target.value),className:"mt-1.5"})]}),e.jsx(w,{type:"submit",variant:"accent",className:"w-full",disabled:S,children:S?"Mencari...":e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Cari Pesanan"]})})]})]}),a&&e.jsxs("div",{className:"mt-8 bg-card rounded-xl border border-border p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-card-foreground",children:"Detail Pesanan"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>ne({...a,customerPhone:n}),className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Invoice"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.status==="active"?"bg-green-100 text-green-700":a.status==="completed"?"bg-gray-100 text-gray-700":"bg-yellow-100 text-yellow-700"}`,children:a.status==="active"?"Aktif":a.status==="completed"?"Selesai":a.status==="confirmed"?"Dikonfirmasi":"Menunggu"})]})]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Nama"}),e.jsx("p",{className:"font-medium",children:a.customerName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Order ID"}),e.jsxs("p",{className:"font-medium font-mono",children:[a.id.slice(0,8),"..."]})]})]}),a.rentalStartDate&&a.rentalEndDate&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Periode Sewa Saat Ini"}),e.jsxs("p",{className:"font-medium",children:[p(f(a.rentalStartDate),"dd MMM",{locale:N})," - ",p(f(a.rentalEndDate),"dd MMM yyyy",{locale:N})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:"Items"}),e.jsx("div",{className:"space-y-2",children:a.items.map((i,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[i.productName," x",i.quantity]}),e.jsxs("span",{className:"font-medium",children:[d(i.pricePerDay),"/hari"]})]},r))})]}),e.jsxs("div",{className:"border-t pt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Saat Ini"}),e.jsx("span",{className:"font-bold text-accent",children:d(a.total)})]})]}),R?e.jsxs("div",{className:"mt-8 pt-6 border-t",children:[e.jsxs("h3",{className:"text-lg font-semibold text-card-foreground mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-accent"}),"Perpanjang Masa Sewa"]}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Perpanjangan Berhasil!"})]}),e.jsxs("div",{className:"text-sm text-green-600 space-y-1",children:[e.jsxs("p",{children:["Masa sewa diperpanjang ",m.extensionDays," hari"]}),e.jsxs("p",{children:["Biaya tambahan: ",d(m.extensionCost)]}),e.jsxs("p",{className:"font-medium",children:["Total baru: ",d(m.newTotal)]})]})]}),e.jsxs(w,{variant:"accent",className:"w-full",onClick:B,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Konfirmasi Pembayaran via WhatsApp"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Tanggal Selesai Baru"}),e.jsxs(K,{children:[e.jsx(L,{asChild:!0,children:e.jsx(w,{variant:"outline",className:"w-full justify-start mt-1.5",children:l?p(l,"dd MMMM yyyy",{locale:N}):"Pilih tanggal"})}),e.jsx(U,{className:"w-auto p-0",align:"start",children:e.jsx(J,{mode:"single",selected:l,onSelect:b,disabled:i=>a.rentalEndDate?i<=f(a.rentalEndDate):!0,className:"pointer-events-auto"})})]})]}),g&&g.extensionDays>0&&e.jsxs("div",{className:"bg-accent/10 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Perpanjangan"}),e.jsxs("span",{className:"font-medium",children:[g.extensionDays," hari"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[d(g.dailyRate)," Ã— ",g.extensionDays," hari"]}),e.jsx("span",{className:"font-medium",children:d(g.extensionCost)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-accent/20",children:[e.jsx("span",{className:"font-semibold",children:"Biaya Tambahan"}),e.jsx("span",{className:"font-bold text-accent",children:d(g.extensionCost)})]})]}),e.jsx(w,{variant:"accent",className:"w-full",onClick:C,disabled:k||!g||g.extensionDays<=0,children:k?"Memproses...":"Konfirmasi Perpanjangan"})]})]}):a.actualReturnDate?e.jsxs("div",{className:"mt-6 bg-gray-50 rounded-lg p-4 flex items-center gap-3",children:[e.jsx($,{className:"w-5 h-5 text-gray-500"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Barang sudah dikembalikan pada ",p(f(a.actualReturnDate),"dd MMMM yyyy",{locale:N})]})]}):a.rentalEndDate?a.status!=="active"?e.jsxs("div",{className:"mt-6 bg-yellow-50 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Perpanjangan hanya tersedia untuk pesanan dengan status aktif."})]}):null:e.jsxs("div",{className:"mt-6 bg-yellow-50 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Tanggal sewa belum diatur oleh admin. Hubungi kami via WhatsApp."})]})]})]})})]})};export{we as default};
