import{c as $,f as ee,r as d,g as se,l as ye,j as e,P as B,h as Ne,k as ke,e as G,B as Pe,X,p as j}from"./index-Dp5V46W7.js";import{u as W,B as T,C as we,c as Se,d as Ce,e as Te,g as De}from"./useAdmin-BxB2P_tw.js";import{u as U}from"./useMutation-6ksDtqKl.js";import{A as Ie}from"./AdminLayout-3U3SLMcL.js";import{I as D}from"./input-Ccy3rJvP.js";import{T as Ee}from"./textarea-Du0_2yXs.js";import{L as x}from"./label-DcpSdAy0.js";import{u as Me}from"./index-C1YjNfLO.js";import{D as Re,a as Fe,b as _e,c as $e}from"./dialog-COFoAsB1.js";import{T as Be,a as Le,b as F,c as b,d as ze,e as g}from"./table-DyyXYKSB.js";import{S as Ae,a as qe,b as He,c as Ue,d as Ke}from"./select-DdEMORC5.js";import{f as Ge,b as Oe,d as Ve}from"./api-9T2QbLlA.js";import{L as Qe}from"./loader-circle-DIrpE8PJ.js";import{P as Xe}from"./plus-CAgRuiIJ.js";import{T as We}from"./trash-2-B4YhzpcP.js";import"./package-kCUf3xtc.js";import"./index-CU77mCJl.js";import"./Combination-D7J0VMFL.js";import"./index-BdQq_4o_.js";import"./chevron-down-DaxDHgOO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=$("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=$("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=$("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=$("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var L="Switch",[es,_s]=ee(L),[ss,as]=es(L),re=d.forwardRef((a,r)=>{const{__scopeSwitch:n,name:o,checked:t,defaultChecked:l,required:m,disabled:c,value:u="on",onCheckedChange:p,form:h,...y}=a,[N,k]=d.useState(null),P=se(r,S=>k(S)),w=d.useRef(!1),I=N?h||!!N.closest("form"):!0,[f,z]=ye({prop:t,defaultProp:l??!1,onChange:p,caller:L});return e.jsxs(ss,{scope:n,checked:f,disabled:c,children:[e.jsx(B.button,{type:"button",role:"switch","aria-checked":f,"aria-required":m,"data-state":oe(f),"data-disabled":c?"":void 0,disabled:c,value:u,...y,ref:P,onClick:Ne(a.onClick,S=>{z(A=>!A),I&&(w.current=S.isPropagationStopped(),w.current||S.stopPropagation())})}),I&&e.jsx(ne,{control:N,bubbles:!w.current,name:o,value:u,checked:f,required:m,disabled:c,form:h,style:{transform:"translateX(-100%)"}})]})});re.displayName=L;var te="SwitchThumb",ie=d.forwardRef((a,r)=>{const{__scopeSwitch:n,...o}=a,t=as(te,n);return e.jsx(B.span,{"data-state":oe(t.checked),"data-disabled":t.disabled?"":void 0,...o,ref:r})});ie.displayName=te;var rs="SwitchBubbleInput",ne=d.forwardRef(({__scopeSwitch:a,control:r,checked:n,bubbles:o=!0,...t},l)=>{const m=d.useRef(null),c=se(m,l),u=Me(n),p=ke(r);return d.useEffect(()=>{const h=m.current;if(!h)return;const y=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(y,"checked").set;if(u!==n&&k){const P=new Event("click",{bubbles:o});k.call(h,n),h.dispatchEvent(P)}},[u,n,o]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...t,tabIndex:-1,ref:c,style:{...t.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ne.displayName=rs;function oe(a){return a?"checked":"unchecked"}var le=re,ts=ie;const ce=d.forwardRef(({className:a,...r},n)=>e.jsx(le,{className:G("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a),...r,ref:n,children:e.jsx(ts,{className:G("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ce.displayName=le.displayName;var O="Progress",V=100,[is,$s]=ee(O),[ns,os]=is(O),de=d.forwardRef((a,r)=>{const{__scopeProgress:n,value:o=null,max:t,getValueLabel:l=ls,...m}=a;(t||t===0)&&!Y(t)&&console.error(cs(`${t}`,"Progress"));const c=Y(t)?t:V;o!==null&&!J(o,c)&&console.error(ds(`${o}`,"Progress"));const u=J(o,c)?o:null,p=_(u)?l(u,c):void 0;return e.jsx(ns,{scope:n,value:u,max:c,children:e.jsx(B.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":_(u)?u:void 0,"aria-valuetext":p,role:"progressbar","data-state":pe(u,c),"data-value":u??void 0,"data-max":c,...m,ref:r})})});de.displayName=O;var ue="ProgressIndicator",me=d.forwardRef((a,r)=>{const{__scopeProgress:n,...o}=a,t=os(ue,n);return e.jsx(B.div,{"data-state":pe(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...o,ref:r})});me.displayName=ue;function ls(a,r){return`${Math.round(a/r*100)}%`}function pe(a,r){return a==null?"indeterminate":a===r?"complete":"loading"}function _(a){return typeof a=="number"}function Y(a){return _(a)&&!isNaN(a)&&a>0}function J(a,r){return _(a)&&!isNaN(a)&&a<=r&&a>=0}function cs(a,r){return`Invalid prop \`max\` of value \`${a}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${V}\`.`}function ds(a,r){return`Invalid prop \`value\` of value \`${a}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${V} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var he=de,us=me;const ge=d.forwardRef(({className:a,value:r,...n},o)=>e.jsx(he,{ref:o,className:G("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...n,children:e.jsx(us,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));ge.displayName=he.displayName;const Z=a=>a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`,ms=a=>{switch(a){case"compressing":return 33;case"uploading":return 66;case"done":return 100;default:return 0}},ps=a=>{switch(a){case"compressing":return"Mengompres...";case"uploading":return"Mengupload...";case"done":return"Selesai";default:return""}},hs=({uploads:a})=>a.length===0?null:e.jsxs("div",{className:"space-y-3 p-3 bg-muted/50 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["Mengupload ",a.length," gambar"]})]}),a.map((r,n)=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground truncate max-w-[200px]",children:[r.stage==="done"?e.jsx(Ye,{className:"w-3.5 h-3.5 text-green-500 flex-shrink-0"}):e.jsx(Qe,{className:"w-3.5 h-3.5 animate-spin flex-shrink-0"}),e.jsx(Je,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r.fileName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground flex-shrink-0",children:[e.jsx("span",{children:ps(r.stage)}),r.compressedSize&&r.stage==="done"&&e.jsxs("span",{className:"text-green-600",children:["(",Z(r.originalSize)," â†’ ",Z(r.compressedSize),")"]})]})]}),e.jsx(ge,{value:ms(r.stage),className:"h-1.5"})]},n))]}),K={name:"",category:"",pricePerDay:0,deposit:0,stock:0,description:"",images:[],discount:0,available:!0},Bs=()=>{const[a,r]=d.useState(!1),[n,o]=d.useState(null),[t,l]=d.useState(K),[m,c]=d.useState(!1),[u,p]=d.useState([]),h=Pe(),{data:y=[],isLoading:N}=W({queryKey:["products"],queryFn:Oe}),{data:k=[]}=W({queryKey:["categories"],queryFn:Ve}),P=U({mutationFn:Se,onSuccess:()=>{h.invalidateQueries({queryKey:["products"]}),j.success("Produk berhasil ditambahkan"),f()},onError:()=>{j.error("Gagal menambahkan produk")}}),w=U({mutationFn:({id:s,updates:i})=>Ce(s,i),onSuccess:()=>{h.invalidateQueries({queryKey:["products"]}),j.success("Produk berhasil diperbarui"),f()},onError:()=>{j.error("Gagal memperbarui produk")}}),I=U({mutationFn:Te,onSuccess:()=>{h.invalidateQueries({queryKey:["products"]}),j.success("Produk berhasil dihapus")},onError:()=>{j.error("Gagal menghapus produk")}}),f=()=>{r(!1),o(null),l(K)},z=()=>{o(null),l(K),r(!0)},S=s=>{o(s),l({name:s.name,category:s.category,pricePerDay:s.pricePerDay,deposit:s.deposit,stock:s.stock,description:s.description,images:s.images,discount:0,available:s.available}),r(!0)},A=s=>{s.preventDefault(),n?w.mutate({id:n.id,updates:t}):P.mutate(t)},xe=async s=>{const i=s.target.files;if(!(i!=null&&i.length))return;c(!0);const E=Array.from(i),q=E.map(C=>({stage:"compressing",fileName:C.name,originalSize:C.size}));p(q);try{const C=[];for(let v=0;v<E.length;v++){const je=E[v],Q=await De(je,H=>{p(M=>M.map((R,be)=>be===v?{...R,stage:H}:R))});p(H=>H.map((M,R)=>R===v?{...M,stage:"done",compressedSize:Q.compressedSize}:M)),C.push(Q.url)}l(v=>({...v,images:[...v.images,...C]})),j.success(`${i.length} gambar berhasil diupload`)}catch{j.error("Gagal mengupload gambar")}finally{c(!1),setTimeout(()=>p([]),2e3)}},fe=s=>{l(i=>({...i,images:i.images.filter((E,q)=>q!==s)}))},ve=s=>{confirm("Yakin ingin menghapus produk ini?")&&I.mutate(s)};return e.jsxs(Ie,{title:"Kelola Produk",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(T,{onClick:z,className:"gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Tambah Produk"]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border",children:e.jsxs(Be,{children:[e.jsx(Le,{children:e.jsxs(F,{children:[e.jsx(b,{children:"Gambar"}),e.jsx(b,{children:"Nama"}),e.jsx(b,{children:"Kategori"}),e.jsx(b,{children:"Harga/Hari"}),e.jsx(b,{children:"Stok"}),e.jsx(b,{children:"Diskon"}),e.jsx(b,{children:"Status"}),e.jsx(b,{className:"text-right",children:"Aksi"})]})}),e.jsx(ze,{children:N?e.jsx(F,{children:e.jsx(g,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"Memuat data..."})}):y.length===0?e.jsx(F,{children:e.jsx(g,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"Belum ada produk"})}):y.map(s=>e.jsxs(F,{children:[e.jsx(g,{children:e.jsx("img",{src:s.images[0]||"/placeholder.svg",alt:s.name,className:"w-12 h-12 rounded-lg object-cover"})}),e.jsx(g,{className:"font-medium",children:s.name}),e.jsx(g,{children:s.category}),e.jsx(g,{children:Ge(s.pricePerDay)}),e.jsx(g,{children:s.stock}),e.jsx(g,{children:"0%"}),e.jsx(g,{children:s.available?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[e.jsx(we,{className:"w-3 h-3"}),"Tersedia"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(X,{className:"w-3 h-3"}),"Tidak Tersedia"]})}),e.jsxs(g,{className:"text-right",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>S(s),children:e.jsx(Ze,{className:"w-4 h-4"})}),e.jsx(T,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>ve(s.id),children:e.jsx(We,{className:"w-4 h-4"})})]})]},s.id))})]})}),e.jsx(Re,{open:a,onOpenChange:r,children:e.jsxs(Fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(_e,{children:e.jsx($e,{children:n?"Edit Produk":"Tambah Produk Baru"})}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Nama Produk"}),e.jsx(D,{id:"name",value:t.name,onChange:s=>l(i=>({...i,name:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Kategori"}),e.jsxs(Ae,{value:t.category,onValueChange:s=>l(i=>({...i,category:s})),children:[e.jsx(qe,{children:e.jsx(He,{placeholder:"Pilih kategori"})}),e.jsx(Ue,{children:k.map(s=>e.jsx(Ke,{value:s.id,children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"pricePerDay",children:"Harga/Hari (Rp)"}),e.jsx(D,{id:"pricePerDay",type:"number",value:t.pricePerDay,onChange:s=>l(i=>({...i,pricePerDay:parseInt(s.target.value)||0})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"deposit",children:"Deposit (Rp)"}),e.jsx(D,{id:"deposit",type:"number",value:t.deposit,onChange:s=>l(i=>({...i,deposit:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"stock",children:"Stok"}),e.jsx(D,{id:"stock",type:"number",value:t.stock,onChange:s=>l(i=>({...i,stock:parseInt(s.target.value)||0})),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"discount",children:"Diskon (%)"}),e.jsx(D,{id:"discount",type:"number",min:"0",max:"100",value:t.discount,onChange:s=>l(i=>({...i,discount:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(ce,{checked:t.available,onCheckedChange:s=>l(i=>({...i,available:s}))}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.available?"Tersedia":"Tidak Tersedia"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"Deskripsi"}),e.jsx(Ee,{id:"description",value:t.description,onChange:s=>l(i=>({...i,description:s.target.value})),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Gambar Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.images.map((s,i)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s,alt:`Product ${i+1}`,className:"w-20 h-20 rounded-lg object-cover"}),e.jsx("button",{type:"button",onClick:()=>fe(i),className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground w-5 h-5 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(X,{className:"w-3 h-3"})})]},i)),e.jsxs("label",{className:"w-20 h-20 rounded-lg border-2 border-dashed border-border hover:border-primary flex items-center justify-center cursor-pointer transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:xe,className:"hidden",disabled:m}),m?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}):e.jsx(ae,{className:"w-5 h-5 text-muted-foreground"})]})]}),e.jsx(hs,{uploads:u})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{type:"button",variant:"outline",onClick:f,children:"Batal"}),e.jsx(T,{type:"submit",disabled:P.isPending||w.isPending,children:n?"Simpan Perubahan":"Tambah Produk"})]})]})]})})]})};export{Bs as default};
