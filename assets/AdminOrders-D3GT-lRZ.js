import{c as ae,r as y,B as se,j as e,p as i}from"./index-Dp5V46W7.js";import{u as te,B as n,h as ne,i as le,p as re,j as ie,f as de}from"./useAdmin-BxB2P_tw.js";import{u as M}from"./useMutation-6ksDtqKl.js";import{A as ce}from"./AdminLayout-3U3SLMcL.js";import{B as oe}from"./badge-BgO9vWjm.js";import{L as C}from"./label-DcpSdAy0.js";import{P as k,b as E,c as R,C as O}from"./popover-CBVDSgDv.js";import{D as F,a as A,b as B,c as q,d as H}from"./dialog-COFoAsB1.js";import{T as me,a as ue,b as w,c as g,d as xe,e as c}from"./table-DyyXYKSB.js";import{D as he,a as je,b as ge,d as pe}from"./dropdown-menu-Cc7uZZE_.js";import{f as j}from"./api-9T2QbLlA.js";import{C as ye}from"./chevron-down-DaxDHgOO.js";import{T as $}from"./triangle-alert-DIdpdKCF.js";import{E as fe}from"./eye-Cn8to-46.js";import{T as Ne}from"./trash-2-B4YhzpcP.js";import{f as l,i as o}from"./id-8SRIAgvI.js";import{p as m}from"./parseISO-C80PuECi.js";import"./package-kCUf3xtc.js";import"./chevron-left-Df98c0fY.js";import"./Combination-D7J0VMFL.js";import"./index-CU77mCJl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ae("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),I=[{value:"pending",label:"Menunggu",color:"bg-yellow-100 text-yellow-700"},{value:"confirmed",label:"Dikonfirmasi",color:"bg-blue-100 text-blue-700"},{value:"active",label:"Aktif (Disewa)",color:"bg-green-100 text-green-700"},{value:"completed",label:"Selesai",color:"bg-gray-100 text-gray-700"},{value:"cancelled",label:"Dibatalkan",color:"bg-red-100 text-red-700"}],De=s=>I.find(f=>f.value===s)||I[0],He=()=>{const[s,f]=y.useState(null),[d,N]=y.useState(null),[S,b]=y.useState(null),[u,K]=y.useState(new Date),[x,Q]=y.useState(),[p,z]=y.useState(),D=se(),{data:L=[],isLoading:Y}=te({queryKey:["admin-orders"],queryFn:de}),J=M({mutationFn:({id:a,status:t})=>ne(a,t),onSuccess:()=>{D.invalidateQueries({queryKey:["admin-orders"]}),i.success("Status pesanan berhasil diperbarui")},onError:()=>{i.error("Gagal memperbarui status")}}),U=M({mutationFn:le,onSuccess:()=>{D.invalidateQueries({queryKey:["admin-orders"]}),i.success("Pesanan berhasil dihapus")},onError:()=>{i.error("Gagal menghapus pesanan")}}),P=M({mutationFn:async({order:a,returnDate:t})=>{if(!a.rentalEndDate)throw new Error("Tanggal akhir sewa belum diatur");const r=a.items.reduce((h,v)=>h+v.pricePerDay*v.quantity,0);return re(a.id,l(t,"yyyy-MM-dd"),a.rentalEndDate,r)},onSuccess:a=>{D.invalidateQueries({queryKey:["admin-orders"]}),a.lateDays>0?i.warning(`Terlambat ${a.lateDays} hari. Denda: ${j(a.lateFee)}`):i.success("Barang dikembalikan tepat waktu!"),N(null)},onError:a=>{i.error(a.message||"Gagal memproses pengembalian")}}),T=M({mutationFn:async({orderId:a,startDate:t,endDate:r})=>ie(a,l(t,"yyyy-MM-dd"),l(r,"yyyy-MM-dd")),onSuccess:()=>{D.invalidateQueries({queryKey:["admin-orders"]}),i.success("Tanggal sewa berhasil diperbarui"),b(null)},onError:()=>{i.error("Gagal memperbarui tanggal sewa")}}),V=a=>{confirm("Yakin ingin menghapus pesanan ini?")&&U.mutate(a)},W=()=>{d&&u&&P.mutate({order:d,returnDate:u})},X=()=>{S&&x&&p&&T.mutate({orderId:S.id,startDate:x,endDate:p})},Z=a=>{b(a),Q(a.rentalStartDate?m(a.rentalStartDate):new Date),z(a.rentalEndDate?m(a.rentalEndDate):new Date)},_=a=>{if(!a.rentalEndDate){i.error("Atur tanggal sewa terlebih dahulu sebelum memproses pengembalian");return}N(a),K(new Date)};return e.jsxs(ce,{title:"Kelola Pesanan",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border overflow-x-auto",children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(w,{children:[e.jsx(g,{children:"ID"}),e.jsx(g,{children:"Pelanggan"}),e.jsx(g,{children:"Total"}),e.jsx(g,{children:"Periode Sewa"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Denda"}),e.jsx(g,{className:"text-right",children:"Aksi"})]})}),e.jsx(xe,{children:Y?e.jsx(w,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Memuat data..."})}):L.length===0?e.jsx(w,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Belum ada pesanan"})}):L.map(a=>{const t=De(a.status),r=a.rentalStartDate&&a.rentalEndDate;return e.jsxs(w,{children:[e.jsxs(c,{className:"font-mono text-xs",children:[a.id.slice(0,8),"..."]}),e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.customerName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.customerPhone})]})}),e.jsx(c,{children:j(a.total)}),e.jsx(c,{children:r?e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{children:l(m(a.rentalStartDate),"dd MMM",{locale:o})}),e.jsxs("p",{className:"text-muted-foreground",children:["s/d ",l(m(a.rentalEndDate),"dd MMM yyyy",{locale:o})]})]}):e.jsx(n,{variant:"ghost",size:"sm",className:"text-xs text-orange-600 hover:text-orange-700",onClick:()=>Z(a),children:"Atur Tanggal"})}),e.jsx(c,{children:e.jsxs(he,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(n,{variant:"ghost",size:"sm",className:`gap-1 ${t.color}`,children:[t.label,e.jsx(ye,{className:"w-3 h-3"})]})}),e.jsx(ge,{children:I.map(h=>e.jsx(pe,{onClick:()=>J.mutate({id:a.id,status:h.value}),children:e.jsx(oe,{className:h.color,children:h.label})},h.value))})]})}),e.jsx(c,{children:a.lateFee>0?e.jsxs("div",{className:"flex items-center gap-1 text-orange-600",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:j(a.lateFee)})]}):a.actualReturnDate?e.jsx("span",{className:"text-xs text-green-600",children:"Tepat waktu"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[a.status==="active"&&r&&e.jsx(n,{variant:"ghost",size:"icon",title:"Proses Pengembalian",onClick:()=>_(a),className:"text-green-600 hover:text-green-700",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>f(a),children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>V(a.id),children:e.jsx(Ne,{className:"w-4 h-4"})})]})})]},a.id)})})]})}),e.jsx(F,{open:!!s,onOpenChange:()=>f(null),children:e.jsxs(A,{className:"max-w-lg",children:[e.jsx(B,{children:e.jsx(q,{children:"Detail Pesanan"})}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Nama Pelanggan"}),e.jsx("p",{className:"font-medium",children:s.customerName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Telepon"}),e.jsx("p",{className:"font-medium",children:s.customerPhone})]}),s.customerEmail&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:s.customerEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Pengambilan"}),e.jsx("p",{className:"font-medium",children:"Ambil di Toko"})]}),s.rentalStartDate&&s.rentalEndDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Periode Sewa"}),e.jsxs("p",{className:"font-medium",children:[l(m(s.rentalStartDate),"dd MMM",{locale:o})," - ",l(m(s.rentalEndDate),"dd MMM yyyy",{locale:o})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:"Items"}),e.jsx("div",{className:"space-y-2",children:s.items.map((a,t)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{children:[a.productName," x",a.quantity," (",a.days," hari)"]}),e.jsx("span",{className:"font-medium",children:j(a.pricePerDay*a.quantity*a.days)})]},t))})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Sewa"}),e.jsx("span",{children:j(s.total)})]}),s.lateFee>0&&e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsxs("span",{children:["Denda Keterlambatan (",s.lateDays," hari)"]}),e.jsx("span",{className:"font-medium",children:j(s.lateFee)})]}),s.lateFee>0&&e.jsxs("div",{className:"flex justify-between font-bold text-base border-t pt-2",children:[e.jsx("span",{children:"Total + Denda"}),e.jsx("span",{children:j(s.total+s.lateFee)})]})]}),s.actualReturnDate&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm mb-1",children:"Tanggal Pengembalian"}),e.jsx("p",{className:"text-sm font-medium",children:l(m(s.actualReturnDate),"dd MMMM yyyy",{locale:o})})]}),s.notes&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm mb-1",children:"Catatan"}),e.jsx("p",{className:"text-sm",children:s.notes})]})]})]})}),e.jsx(F,{open:!!S,onOpenChange:()=>b(null),children:e.jsxs(A,{className:"max-w-md",children:[e.jsx(B,{children:e.jsx(q,{children:"Atur Tanggal Sewa"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Tanggal Mulai Sewa"}),e.jsxs(k,{children:[e.jsx(E,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"w-full justify-start mt-1.5",children:x?l(x,"dd MMMM yyyy",{locale:o}):"Pilih tanggal"})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:x,onSelect:Q,className:"pointer-events-auto"})})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Tanggal Selesai Sewa"}),e.jsxs(k,{children:[e.jsx(E,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"w-full justify-start mt-1.5",children:p?l(p,"dd MMMM yyyy",{locale:o}):"Pilih tanggal"})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:p,onSelect:z,disabled:a=>x?a<x:!1,className:"pointer-events-auto"})})]})]})]}),e.jsxs(H,{children:[e.jsx(n,{variant:"outline",onClick:()=>b(null),children:"Batal"}),e.jsx(n,{variant:"accent",onClick:X,disabled:!x||!p||T.isPending,children:T.isPending?"Menyimpan...":"Simpan"})]})]})}),e.jsx(F,{open:!!d,onOpenChange:()=>N(null),children:e.jsxs(A,{className:"max-w-md",children:[e.jsx(B,{children:e.jsx(q,{children:"Proses Pengembalian Barang"})}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Batas Pengembalian:"}),e.jsx("p",{className:"font-medium",children:d.rentalEndDate&&l(m(d.rentalEndDate),"dd MMMM yyyy",{locale:o})})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Tanggal Pengembalian Aktual"}),e.jsxs(k,{children:[e.jsx(E,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"w-full justify-start mt-1.5",children:u?l(u,"dd MMMM yyyy",{locale:o}):"Pilih tanggal"})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:u,onSelect:K,className:"pointer-events-auto"})})]})]}),u&&d.rentalEndDate&&(()=>{const a=m(d.rentalEndDate),t=u.getTime()-a.getTime(),r=Math.max(0,Math.ceil(t/(1e3*60*60*24))),h=d.items.reduce((ee,G)=>ee+G.pricePerDay*G.quantity,0),v=r>0?Math.round(h*r):0;return r>0?e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 mb-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["Terlambat ",r," hari"]})]}),e.jsxs("p",{className:"text-sm text-orange-600",children:["Denda (100% harga sewa/hari): ",e.jsx("strong",{children:j(v)})]})]}):e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-700 font-medium",children:"âœ“ Pengembalian tepat waktu"})})})()]}),e.jsxs(H,{children:[e.jsx(n,{variant:"outline",onClick:()=>N(null),children:"Batal"}),e.jsx(n,{variant:"accent",onClick:W,disabled:!u||P.isPending,children:P.isPending?"Memproses...":"Proses Pengembalian"})]})]})})]})};export{He as default};
